function occamy(t,e,i){return this instanceof occamy?(this.doc=window&&window.document?window.document:i,this.container=t instanceof HTMLElement?t:this.doc.querySelector(t),this.opts=Object.assign({dir:null,prefix:"occamy",gap:0},e),"number"!=typeof this.opts.gap&&(this.opts.gap=parseInt(this.opts.gap,10)),this.style(),this[this.opts.dir||(1<this.container.offsetWidth/this.container.offsetHeight?"col":"row")]()):new occamy(t,e,i)}occamy.prototype.style=function(){if(!this.doc.getElementById(this.opts.prefix+"-style")){var t=this.doc.createElement("style");return t.setAttribute("type","text/css"),t.setAttribute("media","screen"),t.setAttribute("id",this.opts.prefix+"-style"),t.appendChild(this.doc.createTextNode("")),this.doc.head.appendChild(t),t.sheet.insertRule("."+this.opts.prefix+"-item { display: block; position: absolute; overflow: hidden; transition: left 0.2s ease, top 0.2s ease; }",0),t.sheet.insertRule("."+this.opts.prefix+"-item > * { display: block; position: absolute; transform-origin: 50% 50%; transform: scale(0); transition: left 0.1s ease, top 0.1s ease, transform .2s ease; }",0),this.stylesheet=t,this}},occamy.prototype.redraw=function(){return this.stylesheet||this.style(),this[this.opts.dir||(1<this.container.offsetWidth/this.container.offsetHeight?"col":"row")]()},occamy.prototype.destroy=function(){var i=this;return[].forEach.call(i.container.getElementsByClassName(i.opts.prefix+"-item"),function(e){["transform","left","top"].forEach(function(t){e.firstChild.style.removeProperty(t)})}),["item","group","container"].forEach(function(t){for(var e=i.container.getElementsByClassName(i.opts.prefix+"-"+t);0<e.length;)i.unwrap(e[0])}),this.stylesheet.parentNode.removeChild(this.stylesheet),this.stylesheet=null,this},occamy.prototype.wrap=function(t,e){var i=this.doc.createElement("div");return i.classList.add(e),t.parentNode.insertBefore(i,t),i.appendChild(t),this},occamy.prototype.unwrap=function(t){for(;t.firstChild;)t.parentNode.insertBefore(t.firstChild,t);return t.parentNode.removeChild(t),this},occamy.prototype.css=function(t,e){for(var i in e)t.style[i]=e[i];return this},occamy.prototype.col=function(){var o=this,s=!(0<o.container.getElementsByClassName(o.opts.prefix+"-item").length),t=s?Array.from(o.container.childNodes):Array.from(o.container.getElementsByClassName(o.opts.prefix+"-item")).reduce(function(t,e){return t.concat(Array.from(e.childNodes))},[]);if(0===t.length)return this;var e=o.container.offsetWidth-1,r=o.container.offsetHeight-1,n=r/e,i=t.reduce(function(t,e){return Math.max(t,e.offsetWidth)},-1/0),f=t.reduce(function(t,e){return t+e.offsetHeight*(i/e.offsetWidth)},0),h=i/(f/r),a=r,c=Math.min(Math.max(1,function(){for(var t=0,e=1/0;t<100;t++){var i=Math.abs(n-a/t/(h*t));if(e<i)return--t;e=i}}()),t.length);e-=o.opts.gap*(c-1);var p=Array(c).fill(null).map(function(t,e){return{num:e,height:0,items:[]}});t.sort(function(t,e){return t.offsetWidth/t.offsetHeight-e.offsetWidth/e.offsetHeight}).forEach(function(t){(p=p.sort(function(t,e){return t.height-e.height}))[0].height+=t.offsetHeight,p[0].items.push(t)});var d=(p=p.map(function(i){return i.width=e/c,i.height=i.items.reduce(function(t,e){return t+e.offsetHeight*(i.width/e.offsetWidth)},0),i.width/=i.height/r,i.height=r,i})).reduce(function(t,e){return t+e.width},0),u=e/d,l=0;return p=p.map(function(i){i.width*=u,i.offset_x=l,i.offset_y=0,i.height=r-o.opts.gap*(i.items.length-1),i.scaleheight=i.items.reduce(function(t,e){return t+e.offsetHeight*(i.width/e.offsetWidth)},0),i.items.forEach(function(t){s&&o.wrap(t,o.opts.prefix+"-item");var e=t.offsetHeight*(i.width/t.offsetWidth)*(i.height/i.scaleheight);o.css(t.parentNode,{display:"block",position:"absolute",top:i.offset_y+"px",left:i.offset_x+"px",height:e+"px",width:i.width+"px"}),o.css(t,{transform:"scale("+Math.min(i.width/t.offsetWidth,e/t.offsetHeight)+")",left:(i.width-t.offsetWidth)/2+"px",top:(e-t.offsetHeight)/2+"px"}),i.offset_y+=e+o.opts.gap}),l+=i.width+o.opts.gap}),this},occamy.prototype.row=function(){var o=this,s=!(0<o.container.getElementsByClassName(o.opts.prefix+"-item").length),t=s?Array.from(o.container.childNodes):Array.from(o.container.getElementsByClassName(o.opts.prefix+"-item")).reduce(function(t,e){return t.concat(Array.from(e.childNodes))},[]);if(0===t.length)return this;var e=o.container.offsetWidth-1,r=o.container.offsetHeight-1,n=e/r,i=t.reduce(function(t,e){return Math.max(t,e.offsetHeight)},-1/0),f=t.reduce(function(t,e){return t+e.offsetWidth*(i/e.offsetHeight)},0),h=i/(f/e),a=e,c=Math.min(Math.max(1,function(){for(var t=0,e=1/0;t<100;t++){var i=Math.abs(n-a/t/(h*t));if(e<i)return--t;e=i}}()),t.length);r-=o.opts.gap*(c-1);var p=Array(c).fill(null).map(function(t,e){return{num:e,width:0,items:[]}});t.sort(function(t,e){return t.offsetHeight/t.offsetWidth-e.offsetHeight/e.offsetWidth}).forEach(function(t){(p=p.sort(function(t,e){return t.width-e.width}))[0].width+=t.offsetWidth,p[0].items.push(t)});var d=(p=p.map(function(i){return i.height=r/c,i.width=i.items.reduce(function(t,e){return t+e.offsetWidth*(i.height/e.offsetHeight)},0),i.height/=i.width/e,i.width=e,i})).reduce(function(t,e){return t+e.height},0),u=r/d,l=0;return p=p.map(function(i){return i.height*=u,i.offset_y=l,i.offset_x=0,i.width=e-o.opts.gap*(i.items.length-1),i.scalewidth=i.items.reduce(function(t,e){return t+e.offsetWidth*(i.height/e.offsetHeight)},0),i.items.forEach(function(t){s&&o.wrap(t,o.opts.prefix+"-item");var e=t.offsetWidth*(i.height/t.offsetHeight)*(i.width/i.scalewidth);o.css(t.parentNode,{display:"block",position:"absolute",top:i.offset_y+"px",left:i.offset_x+"px",height:i.height+"px",width:e+"px"}),o.css(t,{transform:"scale("+Math.min(e/t.offsetWidth,i.height/t.offsetHeight)+")",left:(e-t.offsetWidth)/2+"px",top:(i.height-t.offsetHeight)/2+"px"}),i.offset_x+=e+o.opts.gap}),l+=i.height+o.opts.gap,i}),this},"undefined"!=typeof module&&module.exports&&(module.exports=occamy);